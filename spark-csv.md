# Spark 2.4.7 CSVファイル 入力時・出力時オプション一覧

## 入力時（読み込み時）オプション

| オプション名                | デフォルト値                   | 設定可能項目（全て）                                                  | 説明                                                                                                                                                          | 注意点 |
| --------------------------- | ------------------------------ | --------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------- |
| `sep` / `delimiter`         | `,`                            | 任意の1文字（例: `,` `\t` `;` `\|` など）                             | 区切り文字                                                                                                                                                    |                |
| `encoding` / `charset`      | `UTF-8`                        | 任意のエンコーディング（例: `UTF-8`, `Shift_JIS`, `ISO-8859-1` など） | ファイルのエンコーディング                                                                                                                                    |                |
| `quote`                     | `"`                            | 任意の1文字（例: `"`, `'`, `\0`（無効化））                           | クォート文字（`\0`で無効化）                                                                                                                                  |                |
| `escape`                    | `\`                            | 任意の1文字（例: `\`, `"`, `\0`（無効化））                           | エスケープ文字（`\0`で無効化）                                                                                                                                |                |
| `header`                    | `false`                        | `true`, `false`                                                       | 1行目をヘッダーとして扱うか                                                                                                                                   |                |
| `nullValue`                 | 無し                           | 任意の文字列                                                          | nullとして扱う文字列                                                                                                                                          |                |
| `dateFormat`                | `yyyy-MM-dd`                   | 任意の日時フォーマット（例: `yyyy/MM/dd`, `MM-dd-yyyy` など）         | 日付型のパースフォーマット                                                                                                                                    |                |
| `timestampFormat`           | `yyyy-MM-dd'T'HH:mm:ss.SSSXXX` | 任意の日時フォーマット（例: `yyyy/MM/dd HH:mm:ss` など）              | タイムスタンプ型のパースフォーマット                                                                                                                          |                |
| `ignoreLeadingWhiteSpace`   | `false`                        | `true`, `false`                                                       | フィールドの先頭空白を無視するか                                                                                                                              |                |
| `ignoreTrailingWhiteSpace`  | `false`                        | `true`, `false`                                                       | フィールドの末尾空白を無視するか                                                                                                                              |                |
| `mode`                      | `PERMISSIVE`                   | `PERMISSIVE`, `DROPMALFORMED`, `FAILFAST`                             | パースモード。<br>**PERMISSIVE**: 不正な行はnullで埋めて読み込む。<br>**DROPMALFORMED**: 不正な行はスキップ。<br>**FAILFAST**: 不正な行があると即座にエラー。 |                |
| `multiLine`                 | `false`                        | `true`, `false`                                                       | 複数行にまたがるフィールドを許可するか                                                                                                                        | ★              |
| `lineSep`                   | 無し                           | `\n`, `\r`, `\r\n`                                                    | 行区切り文字                                                                                                                                                  | ★              |
| `maxColumns`                | `20480`                        | 任意の整数（例: `100`, `1000`, `20480` など）                         | 最大カラム数                                                                                                                                                  |                |
| `maxCharsPerColumn`         | `-1`                           | 任意の整数（`-1`は制限なし）                                          | カラムごとの最大文字数                                                                                                                                        |                |
| `escapeQuotes`              | `true`                         | `true`, `false`                                                       | クォート内のエスケープを有効にするか                                                                                                                          |                |
| `emptyValue`                | 無し                           | 任意の文字列                                                          | 空文字列として扱う値                                                                                                                                          |                |
| `nanValue`                  | `NaN`                          | 任意の文字列                                                          | NaNとして扱う値                                                                                                                                               |                |
| `positiveInf`               | `Inf`                          | 任意の文字列                                                          | 正の無限大として扱う値                                                                                                                                        |                |
| `negativeInf`               | `-Inf`                         | 任意の文字列                                                          | 負の無限大として扱う値                                                                                                                                        |                |
| `locale`                    | `en-US`                        | 任意のロケール（例: `ja-JP`, `en-US` など）                           | ロケール                                                                                                                                                      |                |
| `columnNameOfCorruptRecord` | `_corrupt_record`              | 任意のカラム名                                                        | パース失敗時に格納するカラム名                                                                                                                                |                |
| `inferSchema`               | `false`                        | `true`, `false`                                                       | スキーマを自動推定するか                                                                                                                                      | ★              |
| `comment`                   | 無し                           | 任意の1文字（例: `#`, `;` など）                                      | コメント行の開始文字                                                                                                                                          | ★              |

---

## 出力時（書き出し時）オプション

| オプション名           | デフォルト値                   | 設定可能項目（全て）                                                  | 説明                                   | 注意点 |
| ---------------------- | ------------------------------ | --------------------------------------------------------------------- | -------------------------------------- | -------------- |
| `sep` / `delimiter`    | `,`                            | 任意の1文字（例: `,` `\t` `;` `                                       | ` など）                               | 区切り文字     |  |
| `encoding` / `charset` | `UTF-8`                        | 任意のエンコーディング（例: `UTF-8`, `Shift_JIS`, `ISO-8859-1` など） | ファイルのエンコーディング             |                |
| `quote`                | `"`                            | 任意の1文字（例: `"`, `'`, `\0`（無効化））                           | クォート文字（`\0`で無効化）           |                |
| `escape`               | `\`                            | 任意の1文字（例: `\`, `"`, `\0`（無効化））                           | エスケープ文字（`\0`で無効化）         |                |
| `header`               | `false`                        | `true`, `false`                                                       | ヘッダー行を出力するか                 |                |
| `nullValue`            | 無し                           | 任意の文字列                                                          | null値をどの文字列で出力するか         |                |
| `dateFormat`           | `yyyy-MM-dd`                   | 任意の日時フォーマット（例: `yyyy/MM/dd`, `MM-dd-yyyy` など）         | 日付型の出力フォーマット               |                |
| `timestampFormat`      | `yyyy-MM-dd'T'HH:mm:ss.SSSXXX` | 任意の日時フォーマット（例: `yyyy/MM/dd HH:mm:ss` など）              | タイムスタンプ型の出力フォーマット     |                |
| `compression`          | 無し                           | `gzip`, `bzip2`, `none`                                               | 圧縮形式                               |                |
| `quoteAll`             | `false`                        | `true`, `false`                                                       | 全てのフィールドをクォートで囲む       | ★              |
| `escapeQuotes`         | `true`                         | `true`, `false`                                                       | クォート内のエスケープを有効にするか   |                |
| `emptyValue`           | 無し                           | 任意の文字列                                                          | 空文字列として出力する値               |                |
| `lineSep`              | 無し                           | `\n`, `\r`, `\r\n`                                                    | 行区切り文字                           | ★              |
| `multiLine`            | `false`                        | `true`, `false`                                                       | 複数行にまたがるフィールドを許可するか | ★              |
| `locale`               | `en-US`                        | 任意のロケール（例: `ja-JP`, `en-US` など）                           | ロケール                               |                |

---

## 不具合・注意点の内容

- `multiLine`  
  - **注意点:** 複数行フィールドを含むCSVで`multiLine=true`を使うと、パフォーマンスが大きく低下する場合があります。また、改行コードの混在やエスケープの扱いによっては正しくパースできないことがあります。

- `lineSep`  
  - **注意点:** 明示的に指定しない場合、ファイル内の最初の行区切り文字が自動検出されますが、混在していると正しく認識されないことがあります。書き出し時も、指定しないとOS依存の改行になるため、他システムとの連携時は注意が必要です。

- `inferSchema`  
  - **注意点:** `inferSchema=true`を指定すると全データをスキャンするため、ファイルサイズが大きい場合はパフォーマンスが大きく低下します。また、推定結果が意図しない型になることがあります。

- `comment`  
  - **注意点:** コメント行の先頭文字を指定できますが、`multiLine=true`と併用すると意図しない動作になる場合があります。

- `quoteAll`（出力時のみ）  
  - **注意点:** 全てのフィールドをクォートで囲むため、ファイルサイズが大きくなります。読み込み時には効果がありません。

---

**備考:**

- 両方の一覧に記載されているオプションは、**入力・出力どちらでも利用可能**
- 詳細は[公式ドキュメント](https://spark.apache.org/docs/2.4.7/sql-data-sources-csv.html)を参照
